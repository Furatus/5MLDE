openapi: 3.0.3
info:
  title: Wine Quality Prediction API
  description: |
    üç∑ **API de pr√©diction de la qualit√© du vin**
    
    Cette API utilise un mod√®le de Machine Learning pour pr√©dire la qualit√© d'un vin 
    en fonction de ses caract√©ristiques physico-chimiques.
    
    ## Fonctionnalit√©s
    
    * **Pr√©diction** : Obtenir un score de qualit√© (0-10) pour un vin
    * **Auto-update** : Le mod√®le se met √† jour automatiquement depuis MLflow
    * **Monitoring** : Health checks et informations sur le mod√®le
    
    ## Mod√®le
    
    Le mod√®le est entra√Æn√© sur le dataset Wine Quality et pr√©dit un score entre 0 et 10.
  version: 1.0.0
  contact:
    name: Wine Quality Team
    email: support@winequality.com
  license:
    name: MIT

servers:
  - url: http://localhost:8000
    description: Serveur local de d√©veloppement
  - url: http://fastapi:8000
    description: Serveur Docker

tags:
  - name: General
    description: Endpoints g√©n√©raux
  - name: Monitoring
    description: Surveillance et health checks
  - name: Prediction
    description: Pr√©diction de la qualit√© du vin
  - name: Model Management
    description: Gestion du mod√®le ML

paths:
  /:
    get:
      tags:
        - General
      summary: Racine de l'API
      description: Retourne les informations de base sur l'API
      operationId: root
      responses:
        '200':
          description: Informations sur l'API
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Wine Quality Prediction API
                  status:
                    type: string
                    example: running
                  model_name:
                    type: string
                    example: wine-quality-model
                  docs:
                    type: string
                    example: /docs
                  health:
                    type: string
                    example: /health

  /health:
    get:
      tags:
        - Monitoring
      summary: Health check
      description: V√©rifier le statut de l'API et la disponibilit√© du mod√®le
      operationId: health_check
      responses:
        '200':
          description: Statut de sant√© de l'API
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: healthy
                  model_loaded:
                    type: boolean
                    example: true
                  model_name:
                    type: string
                    example: wine-quality-model
                  model_version:
                    type: string
                    example: "3"

  /model/info:
    get:
      tags:
        - Model Management
      summary: Informations sur le mod√®le
      description: Obtenir les m√©tadonn√©es d√©taill√©es du mod√®le actuellement charg√©
      operationId: model_info
      responses:
        '200':
          description: M√©tadonn√©es du mod√®le
          content:
            application/json:
              schema:
                type: object
                properties:
                  model_name:
                    type: string
                    example: wine-quality-model
                  version:
                    type: string
                    example: "3"
                  run_id:
                    type: string
                    example: a1b2c3d4e5f6g7h8i9j0
                  status:
                    type: string
                    example: READY
                  creation_timestamp:
                    type: integer
                    example: 1699564800000
        '503':
          description: Mod√®le non charg√©
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPError'
              example:
                detail: Model not loaded. Please wait for model initialization or train a new model.

  /predict:
    post:
      tags:
        - Prediction
      summary: Pr√©dire la qualit√© du vin
      description: |
        Pr√©dire la qualit√© d'un vin (score 0-10) √† partir de ses caract√©ristiques physico-chimiques.
        
        Le mod√®le v√©rifie automatiquement s'il existe une nouvelle version avant chaque pr√©diction.
      operationId: predict
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WineFeatures'
            examples:
              white_wine:
                summary: Vin blanc
                value:
                  type: white
                  fixed_acidity: 7.0
                  volatile_acidity: 0.27
                  citric_acid: 0.36
                  residual_sugar: 20.7
                  chlorides: 0.045
                  free_sulfur_dioxide: 45.0
                  total_sulfur_dioxide: 170.0
                  density: 1.001
                  pH: 3.0
                  sulphates: 0.45
                  alcohol: 8.8
              red_wine:
                summary: Vin rouge
                value:
                  type: red
                  fixed_acidity: 7.4
                  volatile_acidity: 0.70
                  citric_acid: 0.00
                  residual_sugar: 1.9
                  chlorides: 0.076
                  free_sulfur_dioxide: 11.0
                  total_sulfur_dioxide: 34.0
                  density: 0.9978
                  pH: 3.51
                  sulphates: 0.56
                  alcohol: 9.4
      responses:
        '200':
          description: Pr√©diction r√©ussie
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PredictionResponse'
        '503':
          description: Mod√®le non disponible
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPError'
              example:
                detail: Model 'wine-quality-model' not loaded. Please train and register a model first.
        '500':
          description: Erreur interne
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPError'

  /model/reload:
    post:
      tags:
        - Model Management
      summary: Recharger le mod√®le
      description: Forcer le rechargement manuel de la derni√®re version du mod√®le depuis MLflow
      operationId: reload_model
      responses:
        '200':
          description: Mod√®le recharg√© avec succ√®s
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Model reloaded successfully
                  model_version:
                    type: string
                    example: "3"
                  model_name:
                    type: string
                    example: wine-quality-model
        '404':
          description: Mod√®le non trouv√©
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPError'
              example:
                detail: No model 'wine-quality-model' found in MLflow
        '500':
          description: Erreur lors du rechargement
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPError'

components:
  schemas:
    WineFeatures:
      type: object
      required:
        - type
        - fixed_acidity
        - volatile_acidity
        - citric_acid
        - residual_sugar
        - chlorides
        - free_sulfur_dioxide
        - total_sulfur_dioxide
        - density
        - pH
        - sulphates
        - alcohol
      properties:
        type:
          type: string
          enum:
            - red
            - white
          description: Type de vin
          example: white
        fixed_acidity:
          type: number
          format: float
          minimum: 0
          description: Acidit√© fixe (g/L)
          example: 7.0
        volatile_acidity:
          type: number
          format: float
          minimum: 0
          description: Acidit√© volatile (g/L)
          example: 0.27
        citric_acid:
          type: number
          format: float
          minimum: 0
          description: Acide citrique (g/L)
          example: 0.36
        residual_sugar:
          type: number
          format: float
          minimum: 0
          description: Sucre r√©siduel (g/L)
          example: 20.7
        chlorides:
          type: number
          format: float
          minimum: 0
          description: Chlorures (g/L)
          example: 0.045
        free_sulfur_dioxide:
          type: number
          format: float
          minimum: 0
          description: SO2 libre (mg/L)
          example: 45.0
        total_sulfur_dioxide:
          type: number
          format: float
          minimum: 0
          description: SO2 total (mg/L)
          example: 170.0
        density:
          type: number
          format: float
          minimum: 0
          description: Densit√© (g/cm¬≥)
          example: 1.001
        pH:
          type: number
          format: float
          minimum: 0
          maximum: 14
          description: pH
          example: 3.0
        sulphates:
          type: number
          format: float
          minimum: 0
          description: Sulfates (g/L)
          example: 0.45
        alcohol:
          type: number
          format: float
          minimum: 0
          maximum: 20
          description: Alcool (% vol)
          example: 8.8

    PredictionResponse:
      type: object
      properties:
        quality_prediction:
          type: number
          format: float
          description: Score de qualit√© continu (0-10)
          example: 6.234
        quality_class:
          type: integer
          description: Score de qualit√© arrondi (0-10)
          example: 6
        model_updated:
          type: boolean
          description: Indique si le mod√®le a √©t√© mis √† jour lors de cette pr√©diction
          example: false
        model_version:
          type: string
          description: Version du mod√®le utilis√©
          example: "3"
        model_name:
          type: string
          description: Nom du mod√®le
          example: wine-quality-model
        wine_type:
          type: string
          description: Type de vin (r√©p√©t√© pour confirmation)
          example: white

    HTTPError:
      type: object
      properties:
        detail:
          type: string
          description: Message d'erreur d√©taill√©
          example: Model not loaded